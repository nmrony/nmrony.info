
  <head>

    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Vagrant: Deploying and provisioning an Amazon EC2 instance</title>
    <meta name="description" content="">
    <meta name="theme-color" content="#26a69a">
    <link rel="stylesheet" href="../assets/css/prod.min.css?v=48e2190309">

    <link rel="canonical" href="http://www.nmrony.info/vagrant-deploy-and-provisioning-an-amazon-ec2-instance/">
    <meta name="referrer" content="origin">
    
    <meta property="og:site_name" content="Coding is Poetry">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Vagrant: Deploying and provisioning an Amazon EC2 instance">
    <meta property="og:description" content="Vagrant is a really powerful tool for managing virtual machines. If you’re a developer it can make it push-button simple to setup a dev box on your laptop. It manages the VMs, and uses configuration files to describe specifics...">
    <meta property="og:url" content="http://www.nmrony.info/vagrant-deploy-and-provisioning-an-amazon-ec2-instance/">
    <meta property="article:published_time" content="2016-01-14T18:44:18.000Z">
    <meta property="article:modified_time" content="2016-01-14T18:48:17.000Z">
    <meta property="article:tag" content="vagrant">
    <meta property="article:tag" content="devops">
    <meta property="article:tag" content="aws">
    <meta property="article:tag" content="ec2">
    <meta property="article:tag" content="provision">
    <meta property="article:tag" content="deployment">
    <meta property="article:tag" content="web services">
    <meta property="article:tag" content="amazon">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Vagrant: Deploying and provisioning an Amazon EC2 instance">
    <meta name="twitter:description" content="Vagrant is a really powerful tool for managing virtual machines. If you’re a developer it can make it push-button simple to setup a dev box on your laptop. It manages the VMs, and uses configuration files to describe specifics...">
    <meta name="twitter:url" content="http://www.nmrony.info/vagrant-deploy-and-provisioning-an-amazon-ec2-instance/">
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Coding is Poetry",
    "author": {
        "@type": "Person",
        "name": "Nur Rony",
        "image": "//www.gravatar.com/avatar/92ca2c531374f3c32ceefef5b81a5109?s=250&d=mm&r=x",
        "url": "http://www.nmrony.info/author/nur",
        "sameAs": null,
        "description": null
    },
    "headline": "Vagrant: Deploying and provisioning an Amazon EC2 instance",
    "url": "http://www.nmrony.info/vagrant-deploy-and-provisioning-an-amazon-ec2-instance/",
    "datePublished": "2016-01-14T18:44:18.000Z",
    "dateModified": "2016-01-14T18:48:17.000Z",
    "keywords": "vagrant, devops, aws, ec2, provision, deployment, web services, amazon",
    "description": "Vagrant is a really powerful tool for managing virtual machines. If you’re a developer it can make it push-button simple to setup a dev box on your laptop. It manages the VMs, and uses configuration files to describe specifics..."
}
    </script>

    <meta name="generator" content="Ghost 0.7">
    <link rel="alternate" type="application/rss+xml" title="Coding is Poetry" href="http://www.nmrony.info/rss/">

  </head>

  <body class="post-template tag-vagrant tag-devops tag-aws tag-ec2 tag-provision tag-deployment tag-web-services tag-amazon">

    

<nav class="navbar shaded fixed autohide">
  <div class="navbar--row container">
    <!-- Icon -->
    <div class="navbar--icon">
      <a class="ripple" href="http://www.nmrony.info">
        <i class="mdi mdi-arrow-left"></i>
      </a>
    </div>
    <!-- Title -->
    <span class="navbar--title">Vagrant: Deploying and provisioning an Amazon EC2 instance</span>
  </div>
</nav>


<header class="header shaded bg-darken">
  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar--row container">
      <div class="navbar--icon">
        <a class="ripple" href="http://www.nmrony.info">
          <i class="mdi mdi-arrow-left"></i>
        </a>
      </div>
    </div>
  </nav>
  <!-- Content -->
  <div class="header--content onBottom container">
    <!-- Titles -->
    <h1 class="header--title">Vagrant: Deploying and provisioning an Amazon EC2 instance</h1>
    <h5 class="header--subtitle">
      <i class="mdi mdi-calendar"></i>
      <time datetime="2016-01-15" itemprop="datePublished">
        15 Jan 2016
      </time>
    </h5>
  </div>
  <!-- Background -->

    <img class="bg-image" src="../content/images/2016/01/home-bg.jpg">
  
</header>


<!-- Fabs -->
<div class="fabbar large">
  <div class="fabbar--content container">
    <div class="action-fab large">
  <button class="fab large ripple">
    <i class="mdi mdi-share-variant"></i>
  </button>


  <div class="actions">
    <!-- Twitter -->
    <a class="fab ripple twitter intent" data-width="550" data-height="235" href="https://twitter.com/intent/tweet?text=Vagrant%3A%20Deploying%20and%20provisioning%20an%20Amazon%20EC2%20instance&amp;url=http://www.nmrony.info/vagrant-deploy-and-provisioning-an-amazon-ec2-instance/">
      <i class="mdi mdi-twitter"></i>
    </a>
    <!-- Google+ -->
    <a class="fab ripple google-plus intent" data-width="590" data-height="530" href="https://plus.google.com/share?url=http://www.nmrony.info/vagrant-deploy-and-provisioning-an-amazon-ec2-instance/">
      <i class="mdi mdi-google-plus"></i>
    </a>
    <!-- Facebook -->
    <a class="fab ripple facebook intent" data-width="580" height="235" href="https://www.facebook.com/sharer/sharer.php?u=http://www.nmrony.info/vagrant-deploy-and-provisioning-an-amazon-ec2-instance/">
      <i class="mdi mdi-facebook"></i>
    </a>
  </div>
</div>
  </div>
</div>


<main class="main" role="main">
  <article class="main--content container" role="article">
    
    <div class="post--content"><p>Vagrant is a really powerful tool for managing virtual machines. If you’re a developer it can make it push-button simple to setup a dev box on your laptop. It manages the VMs, and uses configuration files to describe specifics of your machines. We can use VirtualBox, VMWare, AWS, DigitalOcean as provider to launch our servers and automatically provision it.  </p>

<h2>Prerequisites</h2>  

<p>I am assuming you have the latest version of Vagrant installed in your dev machine and familiar with <code>Vagrantfile</code> and its command-line. If you don't know about Vagrant, you can visit the <a title="Vagrant Documentation" href="https://docs.vagrantup.com/v2/" target="_blank">Official docummentation</a> of Vagrant and learn about it.</p>

<p>You need to have a <code>AWS</code> account and the following  </p>

<ul>  
    <li>AWS access key</li>
    <li>AWS secret key</li>
    <li>SSH keypair name</li>
    <li>SSH private key file (.pem extension)</li>
    <li>Make sure the your security group enables SSH (port 22) access from anywhere</li>
</ul>  

<blockquote>
  <p>The EC2 instance used to deploy here may not fit in your AWS Free Tier Plan and cost your money.</p>
</blockquote>

<h2>Setting Environment Variable</h2>  

<p>I like to set these up as environment variables to keep them out of the <code>Vagrantfile</code>. On Mac or Linux systems you can add this to your <code>$HOME/.profile</code> or <code>$HOME/.bashrc</code> file:</p>

<pre><code>export AWS_KEY='your-access-key'  
export AWS_SECRET='your-secret-secret'  
export AWS_KEYNAME='your-keyname'  
export AWS_KEYPATH='your-keypath'  
export AWS_DEFAULT_REGION='your-region'  
</code></pre>

<h2>Install the vagrant-aws plugin</h2>  

<p>To install <strong>vagrant-aws</strong> plugin run the following command in terminal</p>

<pre><code>vagrant plugin install vagrant-aws  
</code></pre>

<h2>Fetch AWS Dummy Box</h2>  

<p>To fetch the Vagrant AWS dummy box run the following command in terminal</p>

<pre><code>vagrant box add dummybox-aws https://github.com/mitchellh/vagrant-aws/raw/master/dummy.box  
</code></pre>

<h2>Creating Vagrantfile</h2>  

<p>Run the following commands in terminal to create a <code>Vagrantfile</code></p>

<pre><code>mkdir -p /path/to/your/dir &amp;&amp; cd $_  
vagrant init dummybox-aws  
</code></pre>

<p>This will create a Vagrantfile in current directory using <code>dummybox-aws</code> that we added in previous step.  </p>

<h2>Configure Vagrantfile</h2>  

<p>Now our Vagrantfile with the specifics needed for AWS. Refer to the <a href="https://github.com/mitchellh/vagrant-aws" target="_blank">vagrant-aws</a> documentation to understand all the options.</p>

<pre><code># -*- mode: ruby -*-
# vi: set ft=ruby :

# Vagrant on AWS Example
# Nur Mohammed Rony

# Adjustable settings
# timezone, like US/Pacific, US/Eastern, UTC, Europe/Warsaw, etc.
CFG_TZ = "US/Pacific"

# Provisioning script
provision_script = &lt;&lt;SCRIPT  
#!/bin/bash

# set timezone
echo "#{CFG_TZ}" &gt; /etc/timezone  
dpkg-reconfigure -f noninteractive tzdata

# install a few base packages
apt-get update  
apt-get install vim curl git build-essential -y  
#long provisioning command
echo Provisioning is complete  
SCRIPT

Vagrant.configure(2) do |config|

  config.vm.box = "dummybox-aws"
  config.vm.synced_folder ".", "/home/ubuntu/devpc", type: "rsync", rsync__exclude: ".git/"
  config.vm.hostname = "stagingbox"
  config.vm.provision :shell, :inline =&gt; provision_script
  config.vm.provider :aws do |aws, override|

    #AWS Settings
    aws.access_key_id = ENV['AWS_KEY']
    aws.secret_access_key = ENV['AWS_KEYNAME']
    aws.region = ENV['AWS_DEFAULT_REGION']

    aws.tags = {
      'Name' =&gt; 'NurRony StagingBox',
      'Team' =&gt; 'devops',
      'Status' =&gt; 'active'
    }

    #Override Settings
    override.ssh.username = "ubuntu"
    override.ssh.private_key_path = ENV['AWS_KEYPATH']

    aws.region_config "us-west-2" do |region|
      region.ami = 'ami-35143705'
      region.instance_type = 'c4.large'
      region.keypair_name = ENV['AWS_KEYNAME']
      region.security_groups = "devops"
    end

  end

end  
</code></pre>

<p>Add or edit more options according to your need.  </p>

<h2>Startup Vagrant box</h2>  

<p>Run the following command to start vagrant box which will create and run an AWS EC2 instance with your provided settings in previous step</p>

<pre><code>vagrant up —provider=aws  
</code></pre>

<h2>Verify in the Amazon dashboard</h2>  

<p>Jump over to your amazon dashboard with <a href="https://console.aws.amazon.com/ec2/v2/home?region=us-west-2#Instances:">this link</a>. If you’re logged in already, that will take you to your EC2 instances. You should see a new one, based on the parameters in your Vagrantfile.  </p>

<h2>Working with newly created EC2 instance</h2>  

<p>You can connect via SSH, stop, reload or re-provision your newly created EC2 instance with regular Vagrant command like below</p>

<pre><code>#To SSH to instance
vagrant ssh  
#To restart the instance or re-provision
vagrant reload reload [--provision]  
#To stop 
vagrant halt  
</code></pre>

<p><strong>Note</strong>  </p>

<ul>  
    <li>You need to configure a specific AMI for Vagrant to use. I find the <a href="http://cloud-images.ubuntu.com/locator/ec2/">Ubuntu Amazon EC2 AMI Finder</a> very helpful to match the version and region I wanted to use.</li>
    <li>A common tripping point is the default security group not allowing SSH (port 22) from any IP address. Also make sure to add any other ports depending on your application (e.g., port 80 for HTTP).</li>
    <li>Once you have the basics working, make sure to read through the <a href="https://github.com/mitchellh/vagrant-aws">vagrant-aws project</a> to understand all the options available.</li>
    <li>Make sure to <code>vagrant destroy</code> your VMs when done, and check the AWS Console to make sure they were terminated correctly (to avoid unexpected charges).</li>
</ul>

<p>Good Luck!!! If you face any problem feel free to poke me.</p></div>
    <div class="divider"></div>

    <div class="post--tags half">
        <a class="ripple" href="../tag/vagrant/" title="vagrant">vagrant</a>
        <a class="ripple" href="../tag/devops/" title="devops">devops</a>
        <a class="ripple" href="../tag/aws/" title="aws">aws</a>
        <a class="ripple" href="../tag/ec2/" title="ec2">ec2</a>
        <a class="ripple" href="../tag/provision/" title="provision">provision</a>
        <a class="ripple" href="../tag/deployment/" title="deployment">deployment</a>
        <a class="ripple" href="../tag/web-services/" title="web services">web services</a>
        <a class="ripple" href="../tag/amazon/" title="amazon">amazon</a>
    </div>

    <div class="post--share half">
      <div class="action-button">
  <a class="button solid shaded ripple" href="index.html#!" style="min-width: 200px;">
    <i class="mdi mdi-share-variant"></i> Share
  </a>


  <div class="actions">
    <!-- Twitter -->
    <a class="button solid shaded ripple twitter intent" data-width="550" data-height="235" href="https://twitter.com/intent/tweet?text=Vagrant%3A%20Deploying%20and%20provisioning%20an%20Amazon%20EC2%20instance&amp;url=http://www.nmrony.info/vagrant-deploy-and-provisioning-an-amazon-ec2-instance/">
      <i class="mdi mdi-twitter"></i> Twitter
    </a>
    <!-- Google+ -->
    <a class="button solid shaded ripple google-plus intent" data-width="590" data-height="530" href="https://plus.google.com/share?url=http://www.nmrony.info/vagrant-deploy-and-provisioning-an-amazon-ec2-instance/">
      <i class="mdi mdi-google-plus"></i> Google+
    </a>
    <!-- Facebook -->
    <a class="button solid shaded ripple facebook intent" data-width="580" height="235" href="https://www.facebook.com/sharer/sharer.php?u=http://www.nmrony.info/vagrant-deploy-and-provisioning-an-amazon-ec2-instance/">
      <i class="mdi mdi-facebook"></i> Facebook
    </a>
  </div>
</div>
    </div>

  </article>
</main>


<div>
  <div id="disqus_thread" class="container"></div>
</div>


<aside class="side">
  <div class="side--content container">
    <div class="side--left">
      <div class="card image">
  <header class="card--header bg-darken">
    <!-- Title -->
    <h5 class="card--title" itemprop="headline">Update VirtualBox Guest Additions in Vagrant Box</h5>
    <span class="card--subtitle">
      <i class="fa fa-calendar-o"></i>
      <time datetime="2016-01-17" itemprop="datePublished">
        17 Jan 2016
      </time>
    </span>
    <!-- Image -->
      <div class="bg-image no-image"></div>
  </header>
  <div class="card--back">
    <p>Sometimes We need to upgrade the guest edition for our Vagrant box working properly with virtualbox provider. Without proper Virtualbox Guest Addition Vagrant sometimes does not provide shared file functionality and does problem with group and/or user permissions. The…</p>
    <a class="button solid shaded ripple right" href="../update-virtualbox-guest-additions-in-vagrant-box/">Go</a>
  </div>
</div>

      <span class="msg">No newer post</span>
    </div>
    <div class="side--right">
      <div class="card image">
  <header class="card--header bg-darken">
    <!-- Title -->
    <h5 class="card--title" itemprop="headline">Setup a private RTMP server with nginx-rtmp-module</h5>
    <span class="card--subtitle">
      <i class="fa fa-calendar-o"></i>
      <time datetime="2016-01-15" itemprop="datePublished">
        15 Jan 2016
      </time>
    </span>
    <!-- Image -->
      <div class="bg-image no-image"></div>
  </header>
  <div class="card--back">
    <p>Real Time Messaging Protocol (RTMP) is one of the most popular way for streaming video, audio or data between a Flash player and a server. You can easily have a private RTMP server using Nginx and a module of it…</p>
    <a class="button solid shaded ripple right" href="../setup-a-private-rtmp-server-with-nginx-rtmp-module/">Go</a>
  </div>
</div>

      <span class="msg">No older post</span>
    </div>
  </div>
</aside>

<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/

var disqus_config = function () {
this.page.identifier = 8; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


    <footer class="footer">
      <div class="footer--top">
      <div class="footer--content container">
        <div class="half">
          <p><a href="http://www.nmrony.info">Coding is Poetry</a><br>
            Thoughts, stories and ideas.</p>
        </div>
        <div class="half">
          <ul class="footer--suscriptions">
            <li>
              <a href="https://www.twitter.com/nmrony" target="_blank">
                <i class="mdi mdi-twitter-box"></i>
              </a>
            </li>
            <!-- <li>
              <a href="#!">
                <i class="mdi mdi-google-plus-box"></i>
              </a>
            </li> -->
            <li>
              <a href="https://www.github.com/nmrony" target="_blank">
                <i class="mdi mdi-github-box"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
      </div>
    </footer>

    <script src="../assets/js/prod.main.js?v=48e2190309"></script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-73097824-1', 'auto');
  ga('send', 'pageview');

</script>
  </body>
